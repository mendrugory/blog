---
title: "Scala: Mutability vs Immutability"
date: 2016-08-26
url: /post/scala-mutability-vs-immutability
---

<div class="blog-content">
 <span class="imgPusher" style="float:left;height:0px">
 </span>
 <span style="display: table;width:95px;position:relative;float:left;max-width:100%;;clear:left;margin-top:0px;*margin-top:0px">
 <a>
  <img alt="Picture" class="galleryImageBorder wsite-image" src="/img/smooth-spiral.png" style="margin-top: 5px; margin-bottom: 10px; margin-left: 0px; margin-right: 130px; none; max-width:100%"/>
 </a>
 <span class="wsite-caption" style="display: table-caption; caption-side: bottom; font-size: 90%; margin-top: -10px; margin-bottom: 10px; text-align: center;">
 </span>
 </span>
 <div class="paragraph" style="display:block;">
  Scala is a general purpose programming language that compiles to Java bytecode, therefore, it will run on the
 <a href="https://en.wikipedia.org/wiki/Java_virtual_machine" target="_blank">
   JVM
 </a>
  . You can code is Scala using an object-oriented approach or a functional approach but almost everybody who codes in Scala tries to do it using the second one. But, why?
 </div>
 <hr style="width:100%;clear:both;visibility:hidden;">
 <div class="paragraph">
   You only need to search on Google and you will find the benefits that are told for many people about immutability like: Thread Safe, Concurrency, Scalability, Maintainability, Performance and many more.
  <br>
  </br>
 </div>
 <div class="paragraph">
   This post will not try to explain these benefits or even to convince you about the immutability. It will only try to perform a very easy coding test. I will try to solve a
  <a href="https://projecteuler.net/" target="_blank">
    project-euler
  </a>
   's problem using both approaches, specifically, the
  <a href="https://projecteuler.net/problem=2" target="_blank">
    problem 2
  </a>
   .
 </div>
 <blockquote>
   Even Fibonacci numbers
  <br>
    Each new term in the Fibonacci sequence is generated by adding the previous two terms. By starting with 1 and 2, the first 10 terms will be:
   <br>
    <span>
    </span>
     1, 2, 3, 5, 8, 13, 21, 34, 55, 89, ...
    <br>
     <span>
     </span>
      By considering the terms in the Fibonacci sequence whose values do not exceed four million, find the sum of the even-valued terms.
 </blockquote>
 <div class="paragraph">
  <strong>
    Code
  </strong>
   :
  <br>
  </br>
 </div>
 <div>
  <div align="left" class="wcustomhtml" id="772766169531586791" style="width: 100%; overflow-y: hidden;">
   <!-- HTML generated using hilite.me -->
   <div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
    <pre style="margin: 0; line-height: 125%">
<span style="color: #888888">object Problem2 {</span>

<span style="color: #888888">  def main(args: Array[String]): Unit = {</span>
<span style="color: #888888">    println("Project Euler 2\n")</span>
<span style="color: #888888">    val number: Int = 4000000</span>
<span style="color: #888888">    println("Mutability Result: \t" + time({mutable(number)}, "Mutability Time: \t"))</span>
<span style="color: #888888">    println()</span>
<span style="color: #888888">    println("Immutability Result: \t" + time({immutable(number)}, "Immutability Result: \t"))</span>
<span style="color: #888888">  }</span>

<span style="color: #888888">  def time[R](block: =&gt; R, introMessage:String): R = {</span>
<span style="color: #888888">    val t0 = System.nanoTime()</span>
<span style="color: #888888">    val result = block</span>
<span style="color: #888888">    val t1 = System.nanoTime()</span>
<span style="color: #888888">    println(introMessage + (t1 - t0) + "ns")</span>
<span style="color: #888888">    result</span>
<span style="color: #888888">  }</span>

<span style="color: #888888">  def mutable(number: Int): Int = {</span>
<span style="color: #888888">    var (first, second, acc) = (1, 2, 2)</span>
<span style="color: #888888">    while (second &lt; number) {</span>
<span style="color: #888888">      val aux = second</span>
<span style="color: #888888">      second += first</span>
<span style="color: #888888">      first = aux</span>
<span style="color: #888888">      if (second % 2 == 0)</span>
<span style="color: #888888">        acc += second</span>
<span style="color: #888888">    }</span>
<span style="color: #888888">    acc</span>
<span style="color: #888888">  }</span>

<span style="color: #888888">  def immutable(number: Int): Int = {</span>
<span style="color: #888888">    immutableFib(1, 2, number, 2)</span>
<span style="color: #888888">  }</span>

<span style="color: #888888">  def immutableFib(first: Int, second: Int, number: Int, acc: Int): Int = {</span>
<span style="color: #888888">    second match {</span>
<span style="color: #888888">      case _ if second &lt; number =&gt;</span>
<span style="color: #888888">        val next = first + second</span>
<span style="color: #888888">        val newAcc = if (next % 2 == 0) acc + next else acc</span>
<span style="color: #888888">        immutableFib(second, next, number, newAcc)</span>
<span style="color: #888888">      case _ =&gt; acc</span>
<span style="color: #888888">    }</span>
<span style="color: #888888">  }</span>
<span style="color: #888888">}</span>
</pre>
   </div>
  </div>
 </div>
 <div class="wsite-spacer" style="height:31px;">
 </div>
 <div class="paragraph">
  <strong>
    Results:
  </strong>
  <br>
  </br>
 </div>
 <div>
  <div align="left" class="wcustomhtml" id="175294253602683322" style="width: 100%; overflow-y: hidden;">
   <!-- HTML generated using hilite.me -->
   <div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
    <pre style="margin: 0; line-height: 125%">
<span style="color: #888888">Project Euler 2</span>

<span style="color: #888888">Mutability Time:   1506573ns</span>
<span style="color: #888888">Mutability Result:         4613732</span>

<span style="color: #888888">Immutability Time:         25331ns</span>
<span style="color: #888888">Immutability Result:       4613732</span>
</pre>
   </div>
  </div>
 </div>
 <div class="paragraph">
  <em>
    Note: Without the time wrapper, measuring directly the elapsed time, the results are much better.
  </em>
  <br>
  </br>
 </div>
 <div class="wsite-spacer" style="height:32px;">
 </div>
 <div class="paragraph">
   Although the two algorithms obtain the same result (
  <em>
    All roads lead to Rome
  </em>
   ) you can see which kind of code will be more maintainable, will work better when you build concurrent systems and will perform better.
  <br>
  </br>
 </div>
 <div class="paragraph">
   It is true that coding in a functional way is not easy, especially when the language has not been designed to do it, but in Scala you can choose the way, therefore, it is up to you.
  <br>
  </br>
 </div>
 </hr>
</div>
